(function(win){if(!win.Common)
var F={Extend:function(dest,source,replace){for(prop in source){if(replace==false&&dest[prop]!=null)continue;dest[prop]=source[prop];};return dest;}};win.Common=F;})(window);(function(){var Config={}
for(var name in Config)window[name]=Config[name];})();Date.prototype.AddDays=function(interval){var dateObj=this;var millisecond=1;var second=millisecond*1000;var minute=second*60;var hour=minute*60;var day=hour*24;var year=day*365;var newDate;var dVal=new Date(dateObj);dVal=dVal.valueOf();newDate=new Date(dVal+day*interval);newDate=new Date(newDate);return newDate;}
function Book(){if(arguments.length>=16){this.BookId=arguments[0];this.BookName=arguments[1];this.AuthorId=arguments[2];this.AuthorName=arguments[3];this.Amount=arguments[4];this.ChapterId=arguments[5];this.ChapterName=arguments[6];this.ChannelId=arguments[7];this.ChannelName=arguments[8];this.CategoryId=arguments[9];this.CategoryName=arguments[10];this.SubcatrgoryId=arguments[11];this.SubcatrgoryName=arguments[12];this.ShowDateTime=arguments[13];this.IsVip=arguments[14];this.IsGirlBook=arguments[15];this.Desc=arguments[16];}
else{this.BookId=arguments[0];this.BookName=arguments[1];this.AuthorId=arguments[2];this.AuthorName=arguments[3];this.CategoryId=arguments[4];this.CategoryName=arguments[5];this.Amount=arguments[6];this.BZ1=arguments[7];this.BZ2=arguments[8];this.BZ3=arguments[9];}};if(!window.StringBuilder){StringBuilder=function(value){this.strings=new Array("");this.append(value);};StringBuilder.prototype.append=function(value){if(value)this.strings.push(value);};StringBuilder.prototype.clear=function(){this.strings.length=1;}
StringBuilder.prototype.toString=function(){return this.strings.join("");}}
(function(){if(!String.prototype.format){String.prototype.format=function(){var args=arguments;return this.replace(/\{(\d+)\}/g,function(m,i,o,n){return args[i];});};}
if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}
String.prototype.realLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length;}})();(function(){var Funcs={ParseJsonDate:function(){var jsonDate=arguments[0];var date=new Date(parseInt(jsonDate.substr(6)));return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+(date.getMinutes()<10?("0"+date.getMinutes()):date.getMinutes())+":"+(date.getSeconds()<10?("0"+date.getSeconds()):date.getSeconds());},toggleCategory:function(index){if(index&&index==1){if($("#catetop").css("display")=="none"){$("#catetop").show();$(".topnav a:eq(0)").removeClass("open").addClass("close");}
else{$("#catetop").hide();$(".topnav a:eq(0)").removeClass("close").addClass("open");}}
else{if($("#catebtm").css("display")=="none"){$("#catebtm").show();$(".btmnav a:eq(0)").removeClass("close").addClass("open");}
else{$("#catebtm").hide();$(".btmnav a:eq(0)").removeClass("open").addClass("close");}}},toSearch:function(obj){var txtKey=$(obj).parent().prev(".search-left").find(".search-text");if(txtKey.length<=0){Common.ShowMessage("请输入搜索关键字");return;}
var keyword=txtKey.val();keyword=keyword.trim();if(keyword==""){Common.ShowMessage("请输入搜索关键字");return;}
keyword=Common.checkSearchKey(keyword);var url="/bookstore.aspx?";url+="searchkey="+encodeURIComponent(keyword);window.location=url;},query:function(){var s=location.search.replace(/^\?/,"");var args={};var items=s.split("&");var item,name,value;for(var i=0,count=items.length;i<count;i++){item=items[i].split("=");if(item.length===2){name=decodeURIComponent(item[0].toLowerCase());value=decodeURIComponent(item[1].toLowerCase());args[name]=value;}}
return args;},register:function(){var that=this;var query=that.query();var o={from:(query&&query.from?query.from:1),returnurl:(query&&decodeURIComponent(query.returnurl).indexOf("/register.aspx"))<0?location.href:"http://m.qidian.com"};location.href="/register.aspx?"+$.param(o);},login:function(){var that=this;var query=that.query();var o={from:(query&&query.from?query.from:1),returnurl:location.href};location.href="/mlogin.aspx?"+$.param(o);},addToBookshelf:function(bookId){var that=this;var params={ajaxMethod:"addtobookshelf",bookId:bookId};$.ajax({type:"get",cache:false,dataType:"json",url:"../ajax/bookex.ashx",data:params,error:function(data){},success:function(data){if($("#btn_"+bookId).length>0){if((data.isSuccess&&data.isSuccess==1)){$("#btn_"+bookId).text($("#btn_"+bookId).text().replace("加入书架","已加书架"));}
else{if(data.isSuccess===2){$.closeAllDialog();new($.dialog)({title:"提示",isHTML:false,htmlOrUrl:data.msg,hasButton:true,isHasBtnClose:true,cancelCallBack:"$.closeAllDialog();",yesCallBack:"Common.GoToLogin()"}).open();}else{Common.ShowMessage(data.msg);}}}
else{if(data.isSuccess===2){that.login();}else{Common.ShowMessage(data.msg);}}}});},GetCookie:function(name){var arg=name+'=';var alen=arg.length;var clen=document.cookie.length,i=0;while(i<clen){var j=i+alen;if(document.cookie.substring(i,j)==arg)return Common.getCookieVal(j);i=document.cookie.indexOf(' ',i)+1;if(i==0)break};return null;},getCookieVal:function(offset){var endstr=document.cookie.indexOf(';',offset);if(endstr==-1)endstr=document.cookie.length;return unescape(document.cookie.substring(offset,endstr));},SetCookie:function(name,value){var argv=this.SetCookie.arguments;var argc=this.SetCookie.arguments.length;var expires=(argc>2)?argv[2]:null;var path=(argc>3)?argv[3]:null;var domain=(argc>4)?argv[4]:null;var secure=(argc>5)?argv[5]:false;document.cookie=name+'='+escape(value)+((expires==null)?'':('; expires='+expires.toGMTString()))+((path==null)?'':('; path='+path))+((domain==null)?'':('; domain='+domain))+((secure==true)?'; secure':'');},DeleteCookie:function(name){var domain=".qidian.com";if(arguments!=null&&arguments.length>=2){domain=arguments[1];}
Common.SetCookie(name,-1,(new Date()).AddDays(-1),'/',domain);},GetShengpayChargeUrl:function(name,from){$.ajax({type:"get",dataType:"json",url:"/ajax/index.ashx",data:{ajaxMethod:"getshengpaychargeurl",from:from,page:name},success:function(data){if(data&&data.IsSuccess){location.href=data.ReturnString;}
else{Common.ShowMessage(data.ReturnString);}},error:function(data){Common.ShowMessage("很抱歉，充值发生异常，请稍后重试！");}});},toggleTopNav:function(){var box=$("#topNavBox");box.is(":visible")?box.hide():box.show();},bookUrl:function(bookId){location.href="/book/showbook.aspx?bookid="+bookId;},doNT:function(){return false;},GoToLogin:function(){location.href="/mlogin.aspx?returnurl="+encodeURIComponent(location.href);},GoToCharge:function(){var url=arguments[0]||location.href;if(window.top!=window.self){window.top.location.href="/recharge/rechargemode.aspx?returnurl="+encodeURIComponent(url);}
else{location.href="/recharge/rechargemode.aspx?returnurl="+encodeURIComponent(url);}},ShowMessage:function(){Common.CloseDialog();var frameContent=arguments[0]||"";var title=arguments[1]||"提示";var hasClose=true;if(arguments.length>=3){hasClose=arguments[2];}
new($.dialog)({htmlOrUrl:'{0}'.format(frameContent),title:title,isHTML:false,hasButton:false,isHasBtnClose:hasClose}).open();},ShowMessageGo:function(){Common.CloseDialog();var frameContent=arguments[0]||"";var url=arguments[1]||"";var cancel="$.closeAllDialog()";if(url!=""){cancel="location.href='"+url+"'";}
new($.dialog)({htmlOrUrl:'{0}'.format(frameContent),title:'提示',isHTML:false,hasButton:false,isHasBtnClose:true,cancelCallBack:cancel}).open();},ShowLoading:function(){$.closeAllDialog();var msg=arguments[0]||"加载中...";var html='<img src="/images/ajax-loader_1.gif" />&nbsp;'+msg+'';new($.dialog)({title:"提示",htmlOrUrl:html,hasButton:false,isHTML:false,cancelCallBack:"void(0)"}).open();},CloseDialog:function(){$.closeAllDialog();},ShowChargeDialog:function(){if(!Common.checkLoginByCookie()){location.href="/mlogin.aspx?returnurl="+encodeURIComponent(location.href);}
else{var html='<iframe id="frameDialog" src="/recharge/pop/ChargeMode.aspx?returnurl={0}" frameborder="0" marginheight="0" marginwidth="0" style="border: 0 none; height: 100%; width: 100%; margin: 0;padding: 0"></iframe>'.format(encodeURIComponent(location.href));new($.dialog)({htmlOrUrl:html,title:"充值方式",isHTML:true,hasButton:false,isHasCloseBtnBottom:false,isHasBtnClose:true,isFullScreen:true}).open();}},checkLoginByCookie:function(){var cookieId="AUTHTEST";if(window.location.href.toLowerCase().indexOf("qidian.com")>-1){cookieId="cmfuToken";}
if(window.location.href.toLowerCase().indexOf("qidianmm.com")>-1){cookieId="cmfuToken";}
if(window.location.href.toLowerCase().indexOf("qdmm.com")>-1){cookieId="cmfuToken";}
if(window.location.href.toLowerCase().indexOf("qdwenxue.com")>-1){cookieId="cmfuToken";}
if((Common.GetCookie(cookieId)!=null&&Common.GetCookie(cookieId).length>0)){return true;}
return false;},toggleCheckBox:function(id){if($("#"+id).length>0){if($("#"+id).attr("class")=="check"){$("#"+id).removeClass("check").addClass("checked");}
else{$("#"+id).removeClass("checked").addClass("check");}}},checkSearchKey:function(obj){if(obj==null)
return null;if(obj=="")
return"";obj=obj.replace(/\'/g,"");obj=obj.replace(/\"/g,"");obj=obj.replace(/\;/g,"");obj=obj.replace(/</g,"&lt;").replace(/>/g,"&gt;");obj=obj.replace("\n","");return obj;}}
Common.Extend(Common,Funcs,false);})();$(document).ready(function(){var onmessage=function(e){if(e&&e.data){if(e.data=="close"){$.closeAllDialog();}
else if(e.data=="account"){$.closeAllDialog();location.href="/profile/account.aspx";}
else if(e.data=="charge"){$.closeAllDialog();Common.ShowChargeDialog();}}};if(typeof window.addEventListener!='undefined'){window.addEventListener('message',onmessage,false);}else if(typeof window.attachEvent!='undefined'){window.attachEvent('onmessage',onmessage);}});